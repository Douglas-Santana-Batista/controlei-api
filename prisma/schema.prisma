generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Financial_Flow {
  ENTRY
  EXIT
}

enum PaymentType {
  CASH
  CREDIT_CARD
  DEBIT_CARD
  BOLETO
  PIX 
}

enum InstallmentStatus {
  PENDING
  PAID
  OVERDUE
}

model User {
  id_user     Int           @id @default(autoincrement())
  publicId    String
  cpf         String        @unique
  name        String
  password    String
  email       String        @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  categories  Category[]
  subcategory Subcategory[]
  Installment Installment[]

  @@index([email], name: "idx_user_email")
  @@index([cpf], name: "idx_user_cpf")
}

model Category {
  id_category Int           @id @default(autoincrement())
  description String
  budget      Decimal?      @db.Decimal(10, 2)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  id_user     Int
  user        User          @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  subcategory Subcategory[]
}

model Subcategory {
  id_subcategory Int            @id @default(autoincrement())
  description    String
  value          Decimal        @db.Decimal(10, 2)
  payment_type   PaymentType    @default(DEBIT_CARD)
  financial_flow Financial_Flow @default(EXIT)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  id_category    Int
  id_user        Int
  category       Category       @relation(fields: [id_category], references: [id_category], onDelete: Cascade)
  user           User           @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  installment    Installment[]  @relation("SubcategoryInstallments")

  @@index([id_user], name: "idx_expense_user")
  @@index([payment_type], name: "idx_payment_type")
}

model Installment {
  id_installment Int               @id @default(autoincrement())
  amount         Decimal           @db.Decimal(10, 2)
  status         InstallmentStatus @default(PENDING)
  number         Int
  createdAt      DateTime          @default(now())
  id_subcategory Int
  id_user        Int
  user           User              @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  subcategory    Subcategory       @relation("SubcategoryInstallments", fields: [id_subcategory], references: [id_subcategory], onDelete: Cascade)

  @@index([id_user], name: "idx_installment_user")
  @@index([status], name: "idx_installment_status")
}
